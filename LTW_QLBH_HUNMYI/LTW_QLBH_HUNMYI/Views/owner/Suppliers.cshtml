@model IEnumerable<LTW_QLBH_HUNMYI.Models.XUONGIN>
@{
    Layout = "~/Views/Shared/_LayoutOwner.cshtml";
    ViewBag.Title = "Quản lý xưởng in";
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle"></i> @TempData["Success"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle"></i> @TempData["Error"]
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
}

<style>
    .btn-action {
        border-radius: 10px;
        padding: 6px 14px;
        font-weight: 500;
    }

        .btn-action:hover {
            opacity: 0.9;
        }

    .search-filter-section {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .table-custom {
        border-radius: 10px;
        overflow: visible;
    }
</style>

<!-- Header -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-industry"></i> Quản lý xưởng in</h2>
    <a href="@Url.Action("CreateSupplier","Owner")"
       class="btn btn-primary">
        <i class="fas fa-plus"></i> Thêm xưởng in
    </a>
</div>

<!-- Search and Filter Section -->
<div class="search-filter-section">
    <div class="row">
        <div class="col-md-6">
            <div class="input-group">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
                <input type="text" 
                       class="form-control" 
                       id="searchInput" 
                       placeholder="Tìm kiếm theo tên, mã xưởng, địa chỉ...">
            </div>
        </div>
        <div class="col-md-3">
            <select class="form-select" id="statusFilter">
                <option value="">Tất cả trạng thái</option>
                <option value="Hoạt động">Hoạt động</option>
                <option value="Ngừng hợp tác">Ngừng hợp tác</option>
            </select>
        </div>
        <div class="col-md-3 text-end">
            <span class="badge bg-info" id="resultCount">Tổng: @Model.Count() xưởng in</span>
        </div>
    </div>
</div>

<!-- Table -->
<div class="table-responsive table-custom">
    <table class="table table-striped table-hover" id="suppliersTable">
        <thead class="table-dark">
            <tr>
                <th>Mã xưởng</th>
                <th>Tên xưởng</th>
                <th>Địa chỉ</th>
                <th>SDT</th>
                <th>Email</th>
                <th>Người liên hệ</th>
                <th>Trạng thái</th>
                <th width="120">Thao tác</th>
            </tr>
        </thead>

        <tbody>
            @foreach (var x in Model)
            {
                <tr class="supplier-row" 
                    data-search="@(x.MAXI?.ToLower()) @(x.TENXI?.ToLower()) @(x.DIACHI?.ToLower())" 
                    data-status="@x.TRANGTHAI">
                    <td><strong>@x.MAXI</strong></td>
                    <td>@x.TENXI</td>
                    <td>@x.DIACHI</td>
                    <td>@x.SDT</td>
                    <td>@x.EMAIL</td>
                    <td>@x.NGUOILIENHE</td>
                    <td>
                        @if (x.TRANGTHAI == "Hoạt động")
                        {
                            <span class="badge bg-success">Hoạt động</span>
                        }
                        else
                        {
                            <span class="badge bg-secondary">Ngừng hợp tác</span>
                        }
                    </td>
                    <td>
                        <div class="dropdown">
                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" 
                                    data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-cog"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li>
                                    <a class="dropdown-item" href="@Url.Action("SupplierDetail", "Owner", new { id = x.MAXI })">
                                        <i class="fas fa-eye text-info"></i> Xem chi tiết
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="@Url.Action("EditSupplier", "Owner", new { id = x.MAXI })">
                                        <i class="fas fa-edit text-warning"></i> Chỉnh sửa
                                    </a>
                                </li>
                                @if (x.TRANGTHAI == "Hoạt động")
                                {
                                    <li>
                                        <a class="dropdown-item" href="@Url.Action("StopSupplier", "Owner", new { id = x.MAXI })">
                                            <i class="fas fa-pause-circle text-warning"></i> Ngừng hợp tác
                                        </a>
                                    </li>
                                }
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item text-danger" href="@Url.Action("DeleteSupplier", "Owner", new { id = x.MAXI })">
                                        <i class="fas fa-trash-alt"></i> Xóa vĩnh viễn
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    // Search functionality
    document.getElementById('searchInput').addEventListener('keyup', function() {
        filterTable();
    });

    // Status filter
    document.getElementById('statusFilter').addEventListener('change', function() {
        filterTable();
    });

    function filterTable() {
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        const statusValue = document.getElementById('statusFilter').value;
        const rows = document.querySelectorAll('.supplier-row');
        let visibleCount = 0;

        rows.forEach(row => {
            const searchText = row.getAttribute('data-search');
            const rowStatus = row.getAttribute('data-status');
            
            const matchesSearch = searchText.includes(searchValue);
            const matchesStatus = statusValue === '' || rowStatus === statusValue;

            if (matchesSearch && matchesStatus) {
                row.style.display = '';
                visibleCount++;
            } else {
                row.style.display = 'none';
            }
        });

        document.getElementById('resultCount').textContent = `Hiển thị: ${visibleCount} xưởng in`;
    }
</script>
